# ************************************************************************************************
# Warning: YAML source code for Canvas Apps should only be used to review changes made within Power Apps Studio and for minor edits (Preview).
# Use the maker portal to create and edit your Power Apps.
# 
# The schema file for Canvas Apps is available at https://go.microsoft.com/fwlink/?linkid=2304907
# 
# For more information, visit https://go.microsoft.com/fwlink/?linkid=2292623
# ************************************************************************************************
Screens:
  Busca_Pessoas:
    Properties:
      Fill: =RGBA(232, 232, 232, 1)
      LoadingSpinnerColor: =RGBA(0, 51, 102, 1)
      OnVisible: |-
        =Concurrent(
            Refresh(Pessoas),
            Refresh(Assistências),
            Refresh(Assistências_Encerradas)
        );

        Reset(Campo_Busca_Pessoas);

        Concurrent(
            Set(PessoaSelecionada, Blank()),
            Set(RegistroPessoaSelecionada, Blank())
        );

        Set(CriaAssistido,false);
        Set(CriaTarefeiro,false);

        UpdateContext({Cor_Tarefeiro: Color.LightBlue, Cor_Assistido: Color.LightGreen, Cor_Inativo: Color.LightPink});
        UpdateContext({ varColunaOrdenacao: "cr4f5_nomepessoa" })
    Children:
      - RectQuickActionBar1_6:
          Control: Rectangle@2.3.0
          Properties:
            BorderColor: =RGBA(0, 89, 178, 1)
            Fill: =RGBA(0, 51, 102, 1)
            Height: =88
            Width: =Parent.Width
      - Icone_Refresh_Todos_1:
          Control: Classic/Icon@2.5.0
          Properties:
            AccessibleLabel: =Self.Tooltip
            BorderColor: =RGBA(0, 89, 178, 1)
            Color: =RGBA(255, 255, 255, 1)
            Height: =88
            Icon: =Icon.Reload
            OnSelect: |-
              =Concurrent(
                  Refresh(Pessoas),
                  Refresh(Assistências),
                  Refresh(Assistências_Encerradas)
              );
            PaddingBottom: =22
            PaddingLeft: =22
            PaddingRight: =22
            PaddingTop: =22
            PressedFill: =RGBA(255, 255, 255, 0.3)
            TabIndex: =0
            Tooltip: ="Refresh list"
            Width: =88
            X: =Parent.Width - Icone_Cria_Tarefeiro_2.Width - Icone_Sort_Todos_1.Width - Self.Width
      - Icone_Sort_Todos_1:
          Control: Classic/Icon@2.5.0
          Properties:
            AccessibleLabel: =Self.Tooltip
            BorderColor: =RGBA(0, 89, 178, 1)
            Color: =RGBA(255, 255, 255, 1)
            Height: =88
            Icon: =Icon.Sort
            OnSelect: |-
              =UpdateContext({Sort_Todos: !Sort_Todos})
            PaddingBottom: =26
            PaddingLeft: =26
            PaddingRight: =26
            PaddingTop: =26
            PressedFill: =RGBA(255, 255, 255, 0.3)
            TabIndex: =0
            Tooltip: =If(Sort_Todos, "Sort list in reverse alphabetical order", "Sort list in alphabetical order")
            Width: =88
            X: =Parent.Width - Icone_Cria_Tarefeiro_2.Width - Self.Width
      - Icone_Cria_Tarefeiro_2:
          Control: Classic/Icon@2.5.0
          Properties:
            AccessibleLabel: =Self.Tooltip
            BorderColor: =RGBA(0, 89, 178, 1)
            Color: =RGBA(255, 255, 255, 1)
            DisplayMode: =If(DataSourceInfo([@Pessoas], DataSourceInfo.CreatePermission), DisplayMode.Edit, DisplayMode.Disabled)
            Height: =88
            Icon: =Icon.Add
            OnSelect: =NewForm(Form_Edita_Todos);Navigate(Edita_Todos, ScreenTransition.None)
            PaddingBottom: =24
            PaddingLeft: =24
            PaddingRight: =24
            PaddingTop: =24
            PressedFill: =RGBA(255, 255, 255, 0.3)
            TabIndex: =0
            Tooltip: ="Create new item"
            Visible: =false
            Width: =88
            X: =Parent.Width - Self.Width
      - Icone_Voltar_Todos_1:
          Control: Classic/Icon@2.5.0
          Properties:
            AccessibleLabel: =Self.Tooltip
            BorderColor: =RGBA(0, 89, 178, 1)
            Color: =RGBA(255, 255, 255, 1)
            Height: =88
            Icon: =Icon.BackArrow
            OnSelect: |-
              =Set(NomeTemp,Blank());
              Navigate(Principal, ScreenTransition.CoverRight)
            PaddingBottom: =24
            PaddingLeft: =24
            PaddingRight: =24
            PaddingTop: =24
            PressedFill: =RGBA(255, 255, 255, 0.3)
            TabIndex: =0
            Tooltip: ="Back to list"
            Width: =88
      - Lbl_Titulo_Busca_Tarefeiros_2:
          Control: Label@2.5.1
          Properties:
            BorderColor: =RGBA(0, 0, 0, 1)
            Color: =RGBA(255, 255, 255, 1)
            Fill: =RGBA(58, 58, 58, 0)
            Font: =Font.'Open Sans'
            Height: =88
            Size: =27
            Text: ="Busca Pessoas"
            Width: =Parent.Width - Self.X - Icone_Sort_Todos_1.Width - Icone_Cria_Tarefeiro_2.Width - Icone_Refresh_Todos_1.Width
            Wrap: =false
            X: =80
      - Campo_Busca_Pessoas:
          Control: Classic/TextInput@2.3.2
          Properties:
            BorderColor: =RGBA(0, 89, 178, 1)
            Default: =""
            DelayOutput: =true
            Font: =Font.'Open Sans'
            Height: =68
            HintText: ="Busca por nome, nome social ou número"
            HoverBorderColor: =RGBA(0, 89, 178, 1)
            HoverFill: =RGBA(153, 205, 255, 1)
            PaddingLeft: =70
            Width: =Parent.Width
            Y: =RectQuickActionBar1_6.Height
      - SearchIcon1_6:
          Control: Classic/Icon@2.5.0
          Properties:
            BorderColor: =RGBA(0, 89, 178, 1)
            Color: =RGBA(0, 89, 178, 1)
            Height: =Self.Width
            Icon: =Icon.Search
            PaddingBottom: =14
            PaddingLeft: =14
            PaddingRight: =14
            PaddingTop: =14
            Tooltip: ="Search"
            Width: =Campo_Busca_Pessoas.Height
            X: =Campo_Busca_Pessoas.X
            Y: =Campo_Busca_Pessoas.Y
      - Rectangle11_6:
          Control: Rectangle@2.3.0
          Properties:
            BorderColor: =RGBA(0, 89, 178, 1)
            Fill: =RGBA(0, 89, 178, 1)
            Height: =2
            Width: =Parent.Width
            Y: =Campo_Busca_Pessoas.Y + Campo_Busca_Pessoas.Height
      - Btn_CriaAssistido_1:
          Control: Classic/Button@2.2.0
          Properties:
            BorderColor: =ColorFade(Self.Fill, -15%)
            Color: =RGBA(255, 255, 255, 1)
            DisabledBorderColor: =RGBA(166, 166, 166, 1)
            Fill: =RGBA(0, 51, 102, 1)
            Font: =Font.'Open Sans'
            HoverBorderColor: =ColorFade(Self.BorderColor, 20%)
            HoverColor: =RGBA(255, 255, 255, 1)
            HoverFill: =ColorFade(RGBA(0, 51, 102, 1), -20%)
            OnSelect: |-
              =Patch(
                  Logs,
                  Defaults(Logs),
                  {
                      DataeHora: Now(),
                      DeviceID: DeviceID,
                      Ação: "Criando novo Assistido"
                  }
              );

              Set(CriaAssistido,true);

              Set(NomeTemp, Campo_Busca_Pessoas.Text);

              ResetForm(Form_Edita_Assistidos);
              NewForm(Form_Edita_Assistidos);

              Navigate(Edita_Assistido, ScreenTransition.None)
            PressedBorderColor: =Self.Fill
            PressedColor: =Self.Fill
            PressedFill: =Self.Color
            Text: ="Cria Assistido"
            X: =App.MinScreenWidth/4 - Self.Width/2
            Y: =HtmlText_Tarefeiro.Y + HtmlText_Tarefeiro.Height + 15
      - Btn_CriaTarefeiro:
          Control: Classic/Button@2.2.0
          Properties:
            BorderColor: =ColorFade(Self.Fill, -15%)
            Color: =RGBA(255, 255, 255, 1)
            DisabledBorderColor: =RGBA(166, 166, 166, 1)
            Fill: =RGBA(0, 51, 102, 1)
            Font: =Font.'Open Sans'
            HoverBorderColor: =ColorFade(Self.BorderColor, 20%)
            HoverColor: =RGBA(255, 255, 255, 1)
            HoverFill: =ColorFade(RGBA(0, 51, 102, 1), -20%)
            OnSelect: |-
              =Patch(
                  Logs,
                  Defaults(Logs),
                  {
                      DataeHora: Now(),
                      DeviceID: DeviceID,
                      Ação: "Criando novo Tarefeiro"
                  }
              );

              Set(CriaTarefeiro, true);

              Set(NomeTemp, Campo_Busca_Pessoas.Text);

              ResetForm(Form_Edita_Tarefeiros);
              NewForm(Form_Edita_Tarefeiros); 

              Navigate(Edita_Tarefeiros, ScreenTransition.None)
            PressedBorderColor: =Self.Fill
            PressedColor: =Self.Fill
            PressedFill: =Self.Color
            Text: ="Cria Tarefeiro"
            X: =(App.MinScreenWidth/4)*3 - Self.Width/2
            Y: =Btn_CriaAssistido_1.Y
      - Galeria_Busca_Pessoas:
          Control: Gallery@2.15.0
          Variant: BrowseLayout_Vertical_TwoTextVariant_ver5.0
          Properties:
            BorderColor: =RGBA(0, 89, 178, 1)
            Height: |-
              =//978
              Parent.Height - Self.Y
            Items: "=SortByColumns(\r\n    If(\r\n        // Verifica se o texto digitado contém APENAS números\r\n        IsMatch(Campo_Busca_Pessoas.Text, \"^[0-9]+$\"),\r\n        \r\n        // SE FOR NÚMERO: Filtra apenas pelo ID (Começando com o número)\r\n        Filter(\r\n            Pessoas,\r\n            StartsWith('ID Pessoa Texto', Campo_Busca_Pessoas.Text)\r\n        ),\r\n        \r\n        // SE FOR TEXTO OU VAZIO: Usa o Search padrão para buscar pelos nomes\r\n        Search(\r\n            Pessoas,\r\n            Campo_Busca_Pessoas.Text,\r\n            'Nome Pessoa',\r\n            'Nome Social'\r\n        )\r\n    ),\r\n    varColunaOrdenacao,\r\n    If(Sort_Todos, SortOrder.Descending, SortOrder.Ascending)\r\n)\r\n/*\r\nSortByColumns(\r\n    Search(\r\n        Pessoas,\r\n        Campo_Busca_Pessoas.Text,\r\n        'ID Pessoa Texto',        \r\n        'Nome Pessoa',\r\n        'Nome Social'\r\n    ),\r\n    \"cr4f5_nomepessoa\",\r\n    If(Sort_Todos, SortOrder.Descending, SortOrder.Ascending)\r\n)\r\n*/\r\n"
            OnSelect: |-
              =Concurrent(
                  Set(PessoaSelecionada, ThisItem.'ID Pessoa'),
                  Set(RegistroPessoaSelecionada, ThisItem),
                  Set(EmAssistencia, ThisItem.'Em Assistência')
              );

              Patch(
                  Logs,
                  Defaults(Logs),
                  {
                      DataeHora: Now(),
                      DeviceID: DeviceID,
                      Ação: If(ThisItem.Tarefeiro = "Sim",
                          "Visualizando Tarefeiro ID:" & PessoaSelecionada,
                          "Visualizando Todos ID:" & PessoaSelecionada
                      )
                  }
              );

              If(ThisItem.Tarefeiro = "Sim",
                  Navigate(Consulta_Tarefeiros, ScreenTransition.None),
                  Navigate(Consulta_Assistido, ScreenTransition.None)
              )
            ShowScrollbar: =false
            TemplateFill: |-
              =If(
                  ThisItem.Tarefeiro = "Sim",
                  Cor_Tarefeiro,
                  If(
                      ThisItem.'Em Assistência' = "Não",
                      Cor_Inativo,
                      Cor_Assistido
                  )
              )
              //RGBA(0, 0, 0, 0)
            Width: =Parent.Width
            Y: |-
              =//158
              Btn_CriaAssistido_1.Y + Btn_CriaAssistido_1.Height + 15
          Children:
            - Rectangle5_1:
                Control: Rectangle@2.3.0
                Properties:
                  BorderColor: =RGBA(0, 89, 178, 1)
                  Fill: =RGBA(0, 89, 178, 1)
                  Height: =Parent.TemplateHeight - Separator5_1.Height
                  OnSelect: =Select(Parent)
                  Visible: =ThisItem.IsSelected
                  Width: =4
            - Title6_1:
                Control: Label@2.5.1
                Properties:
                  BorderColor: =RGBA(0, 0, 0, 1)
                  Color: =RGBA(50, 49, 48, 1)
                  Font: =Font.'Open Sans'
                  FontWeight: =If(ThisItem.IsSelected, FontWeight.Bold, FontWeight.Normal)
                  Height: =Self.Size * 1.8
                  OnSelect: =Select(Parent)
                  PaddingBottom: =0
                  PaddingLeft: =0
                  PaddingRight: =0
                  PaddingTop: =0
                  Size: =If(ThisItem.IsSelected, 21, 19)
                  Text: =ThisItem.'Nome Pessoa'
                  VerticalAlign: =VerticalAlign.Top
                  Width: =Parent.TemplateWidth - 86
                  X: =16
                  Y: =(Parent.TemplateHeight - (Self.Size*1.8 + Subtitle5_1.Size*1.8)) / 2
            - NextArrow5_1:
                Control: Classic/Icon@2.5.0
                Properties:
                  AccessibleLabel: =Self.Tooltip
                  BorderColor: =RGBA(0, 89, 178, 1)
                  Color: =RGBA(166, 166, 166, 1)
                  Height: =50
                  Icon: =Icon.Edit
                  OnSelect: =Select(Parent)
                  PaddingBottom: =16
                  PaddingLeft: =16
                  PaddingRight: =16
                  PaddingTop: =16
                  Tooltip: ="Exibir detalhes do item"
                  Width: =50
                  X: =Parent.TemplateWidth - Self.Width - 12
                  Y: =(Parent.TemplateHeight / 2) - (Self.Height / 2)
            - Subtitle5_1:
                Control: Label@2.5.1
                Properties:
                  BorderColor: =RGBA(0, 0, 0, 1)
                  Font: =Font.'Open Sans'
                  FontWeight: =If(ThisItem.IsSelected, FontWeight.Bold, FontWeight.Normal)
                  Height: =Self.Size * 1.8
                  OnSelect: =Select(Parent)
                  PaddingBottom: =0
                  PaddingLeft: =0
                  PaddingRight: =0
                  PaddingTop: =0
                  Size: =If(ThisItem.IsSelected, 21, 19)
                  Text: =ThisItem.'ID Pessoa'
                  VerticalAlign: =VerticalAlign.Top
                  Width: =Title6_1.Width
                  X: =Title6_1.X
                  Y: =Title6_1.Y + Title6_1.Height
            - Separator5_1:
                Control: Rectangle@2.3.0
                Properties:
                  BorderColor: =RGBA(0, 89, 178, 1)
                  Fill: =RGBA(255, 255, 255, 1)
                  Height: =8
                  OnSelect: =Select(Parent)
                  Width: =Parent.TemplateWidth
                  Y: =Parent.TemplateHeight - Self.Height
      - HtmlText_Tarefeiro:
          Control: HtmlViewer@2.1.0
          Properties:
            Fill: =Cor_Tarefeiro
            Font: =Font.'Open Sans'
            Height: =50
            HtmlText: |-
              ="<div style='display: flex; justify-content: center; align-items: center;'>
                  <b>Tarefeiro</b>
              </div>"
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Size: =24
            Width: =180
            X: =20
            Y: =Campo_Busca_Pessoas.Y + Campo_Busca_Pessoas.Height + 10
      - HtmlText_Assistido:
          Control: HtmlViewer@2.1.0
          Properties:
            Fill: =Cor_Assistido
            Font: =Font.'Open Sans'
            Height: =50
            HtmlText: |-
              ="<div style='display: flex; justify-content: center; align-items: center;'>
                  <b>Assistido</b>
              </div>"
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Size: =24
            Width: =180
            X: =522
            Y: =166
      - HtmlText_Inativo:
          Control: HtmlViewer@2.1.0
          Properties:
            Fill: =Cor_Inativo
            Font: =Font.'Open Sans'
            Height: =50
            HtmlText: |-
              ="<div style='display: flex; justify-content: center; align-items: center;'>
                  <b>Sem Assistência</b>
              </div>"
            PaddingBottom: =0
            PaddingLeft: =0
            PaddingRight: =0
            PaddingTop: =0
            Size: =24
            Width: =270
            X: =225
            Y: =166
      - Icone_Sort_Todos_2:
          Control: Classic/Icon@2.5.0
          Properties:
            AccessibleLabel: =Self.Tooltip
            BorderColor: =RGBA(0, 89, 178, 1)
            Color: =RGBA(255, 255, 255, 1)
            Height: =88
            Icon: |-
              =If(
                  varColunaOrdenacao = "cr4f5_nomepessoa",
                  Icon.Text, // Mostra o '#' sugerindo mudar para Número
                  Icon.TrendingHashtag         // Mostra o 'A' sugerindo mudar para Texto
              )
            OnSelect: |-
              =If(
                  varColunaOrdenacao = "cr4f5_nomepessoa",
                  UpdateContext({ varColunaOrdenacao: "cr4f5_idpessoa" }), 
                  UpdateContext({ varColunaOrdenacao: "cr4f5_nomepessoa" })  
              )
            PaddingBottom: =26
            PaddingLeft: =26
            PaddingRight: =26
            PaddingTop: =26
            PressedFill: =RGBA(255, 255, 255, 0.3)
            TabIndex: =0
            Tooltip: =If(Sort_Todos, "Sort list in reverse alphabetical order", "Sort list in alphabetical order")
            Width: =88
            X: =632
