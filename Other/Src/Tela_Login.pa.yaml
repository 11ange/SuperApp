# ************************************************************************************************
# Warning: YAML source code for Canvas Apps should only be used to review changes made within Power Apps Studio and for minor edits (Preview).
# Use the maker portal to create and edit your Power Apps.
# 
# The schema file for Canvas Apps is available at https://go.microsoft.com/fwlink/?linkid=2304907
# 
# For more information, visit https://go.microsoft.com/fwlink/?linkid=2292623
# ************************************************************************************************
Screens:
  Tela_Login:
    Properties:
      Fill: =RGBA(232, 232, 232, 1)
      LoadingSpinnerColor: =RGBA(0, 51, 102, 1)
      OnVisible: |+
        =UpdateContext({LoginInvalido: false});
        Reset(txtUsuario);
        Reset(txtSenha);
    Children:
      - Img_CEOV_2:
          Control: Image@2.2.3
          Properties:
            BorderColor: =RGBA(0, 89, 178, 1)
            Height: =372
            Image: =logo
            ImagePosition: =ImagePosition.Fill
            Width: =610
            X: =Parent.Width/2-Self.Width/2
            Y: =194
      - Lbl_Titulo_1:
          Control: Label@2.5.1
          Properties:
            Align: =Align.Center
            BorderColor: =RGBA(0, 89, 178, 1)
            Color: =RGBA(241, 244, 249, 1)
            Fill: =RGBA(0, 18, 107, 1)
            Font: =Font.'Lato Light'
            FontWeight: =FontWeight.Bold
            Height: =158
            Italic: =true
            Size: =35
            Text: ="S I S T E M A   U N I F I C A D O"
            Width: =App.MinScreenWidth
      - Lbl_Usuario_Logado_1:
          Control: Label@2.5.1
          Properties:
            Align: =Align.Center
            BorderColor: =RGBA(0, 89, 178, 1)
            Color: =RGBA(241, 244, 249, 1)
            Fill: =RGBA(0, 18, 107, 1)
            Font: =Font.'Lato Light'
            FontWeight: =FontWeight.Bold
            Height: =96
            Italic: =true
            Size: =35
            Text: |-
              ="
              "
            Width: =App.MinScreenWidth
            Y: =Parent.Height- Self.Height
      - Label6:
          Control: Label@2.5.1
          Properties:
            Align: =Align.Center
            BorderColor: =RGBA(0, 89, 178, 1)
            Font: =Font.'Open Sans'
            Height: =87
            Size: =42
            Text: ="Bem Vindo !"
            Width: =344
            X: =App.MinScreenWidth/2-Self.Width/2
            Y: =554
      - Label7:
          Control: Label@2.5.1
          Properties:
            Align: =Align.Center
            BorderColor: =RGBA(0, 89, 178, 1)
            Font: =Font.'Open Sans'
            Height: =67
            Text: ="Faça o login para continuar"
            Width: =372
            X: =App.MinScreenWidth/2-Self.Width/2
            Y: =641
      - txtUsuario:
          Control: Classic/TextInput@2.3.2
          Properties:
            BorderColor: =RGBA(0, 89, 178, 1)
            Default: =""
            Font: =Font.'Open Sans'
            HintText: ="Usuário"
            HoverBorderColor: =RGBA(0, 89, 178, 1)
            HoverFill: =RGBA(153, 205, 255, 1)
            RadiusBottomLeft: =25
            RadiusBottomRight: =25
            RadiusTopLeft: =25
            RadiusTopRight: =25
            Width: =400
            X: =App.MinScreenWidth/2-Self.Width/2
            Y: =743
      - txtSenha:
          Control: Classic/TextInput@2.3.2
          Properties:
            BorderColor: =RGBA(0, 89, 178, 1)
            Default: =""
            Font: =Font.'Open Sans'
            HintText: ="Senha"
            HoverBorderColor: =RGBA(0, 89, 178, 1)
            HoverFill: =RGBA(153, 205, 255, 1)
            Mode: =TextMode.Password
            RadiusBottomLeft: =25
            RadiusBottomRight: =25
            RadiusTopLeft: =25
            RadiusTopRight: =25
            Width: =400
            X: =App.MinScreenWidth/2-Self.Width/2
            Y: =838
      - btnLogin:
          Control: Classic/Button@2.2.0
          Properties:
            BorderColor: =ColorFade(Self.Fill, -15%)
            Color: =RGBA(255, 255, 255, 1)
            DisabledBorderColor: =RGBA(166, 166, 166, 1)
            Fill: =RGBA(0, 51, 102, 1)
            Font: =Font.'Open Sans'
            HoverBorderColor: =ColorFade(Self.BorderColor, 20%)
            HoverColor: =RGBA(255, 255, 255, 1)
            HoverFill: =ColorFade(RGBA(0, 51, 102, 1), -20%)
            OnSelect: |-
              =// Faça apenas UM LookUp combinando Usuário e Senha
              UpdateContext({
                  ctxUsuarioLogado: LookUp(
                      Usuarios, 
                      Upper('Nome Usuario') = Upper(txtUsuario.Text) && 'Senha Usuario' = txtSenha.Text
                  )
              });

              // Se ctxUsuarioLogado estiver em branco, o login falhou
              UpdateContext({ LoginInvalido: IsBlank(ctxUsuarioLogado) });

              If(!LoginInvalido,
                  Set(Usuario_Logado, ctxUsuarioLogado.'Nome Usuario');
                  Set(Perfil_Logado, ctxUsuarioLogado.'Perfil Usuario');

                  If(Text(Perfil_Logado)="Admin", Navigate(Principal, ScreenTransition.None));
                  //If(Text(Perfil_Logado)="Senha", Navigate(Tela_Principal_Senha, ScreenTransition.None));
              );
              /*
              If(
                  CountRows(
                      Filter(
                          Usuarios,
                          'Senha Usuario' = txtSenha.Text
                      )
                  ) = 1 && 
                  Upper(LookUp(Usuarios, 'Senha Usuario' = txtSenha.Text).'Nome Usuario') = Upper(txtUsuario.Text),
                  UpdateContext({LoginInvalido: false}),
                  UpdateContext({LoginInvalido: true})
              );


              Set(Usuario_Logado,txtUsuario.Text);

              ClearCollect(
                  Usuarios_Local,
                  Filter(Usuarios, 'Nome Usuario' = txtUsuario.Text)
              );

              Set(Perfil_Logado, 
                  LookUp(Usuarios_Local, Upper('Nome Usuario') = Upper(txtUsuario.Text), 'Perfil Usuario')
              );

              //Notify( "Passou aqui"; NotificationType.Information );;

              If(LoginInvalido=false And Text(Perfil_Logado)="Admin", Navigate(Tela_Principal,ScreenTransition.None));
              //If(LoginInvalido=false And Text(Perfil_Logado)="Entrevistador", Navigate(Tela_Principal_Entrevistador,ScreenTransition.None));
              //If(LoginInvalido=false And Text(Perfil_Logado)="Dialogador", Navigate(Tela_Principal_Dialogador,ScreenTransition.None));
              //If(LoginInvalido=false And Text(Perfil_Logado)="Recepção", //Navigate(Tela_Principal_Recepção,ScreenTransition.None));
              //If(LoginInvalido=false And Text(Perfil_Logado)="Mesa", //Navigate(Tela_Principal_Mesa,ScreenTransition.None));
              If(LoginInvalido=false And Text(Perfil_Logado)="Senha", Navigate(Tela_Principal_Senha,ScreenTransition.None));
              */
            PressedBorderColor: =Self.Fill
            PressedColor: =Self.Fill
            PressedFill: =Self.Color
            Text: ="Entrar"
            X: =App.MinScreenWidth/2-Self.Width/2
            Y: =943
      - Fundo_Popup_Login:
          Control: Rectangle@2.3.0
          Group: Popup_Login_Invalido
          Properties:
            BorderColor: =RGBA(0, 89, 178, 1)
            Fill: =RGBA(100, 118, 132, 0.6)
            Height: =1048
            Visible: =LoginInvalido
            Width: =640
            Y: =88
      - Popup_Todos_Login:
          Control: Rectangle@2.3.0
          Group: Popup_Login_Invalido
          Properties:
            BorderColor: =RGBA(0, 89, 178, 1)
            Fill: =Color.White
            Height: =281
            Visible: =LoginInvalido
            Width: =464
            X: =88
            Y: =360
      - lbl_Aviso_popup_Login:
          Control: Label@2.5.1
          Group: Popup_Login_Invalido
          Properties:
            Align: =Align.Center
            BorderColor: =RGBA(0, 89, 178, 1)
            Color: =RGBA(255, 255, 255, 1)
            Fill: =Color.Red
            Font: =Font.'Open Sans'
            FontWeight: =FontWeight.Bold
            Height: =72
            Text: ="Aviso"
            Visible: =LoginInvalido
            Width: =464
            X: =88
            Y: =360
      - lbl_Texto_popup_Login:
          Control: Label@2.5.1
          Group: Popup_Login_Invalido
          Properties:
            Align: =Align.Center
            BorderColor: =RGBA(0, 89, 178, 1)
            Font: =Font.'Open Sans'
            Height: =84
            Text: ="Dados Inválidos!"
            Visible: =LoginInvalido
            Width: =464
            X: =88
            Y: =437
      - Btn_Ok:
          Control: Classic/Button@2.2.0
          Group: Popup_Login_Invalido
          Properties:
            BorderColor: =ColorFade(Self.Fill, -15%)
            Color: =RGBA(255, 255, 255, 1)
            DisabledBorderColor: =RGBA(166, 166, 166, 1)
            Fill: =RGBA(0, 51, 102, 1)
            FocusedBorderColor: =ColorFade(Self.Fill, -75%)
            Font: =Font.'Open Sans'
            Height: =55
            HoverBorderColor: =ColorFade(Self.BorderColor, 20%)
            HoverColor: =RGBA(255, 255, 255, 1)
            HoverFill: =ColorFade(RGBA(0, 51, 102, 1), -20%)
            OnSelect: |+
              =UpdateContext({LoginInvalido:false});

            PressedBorderColor: =Self.Fill
            PressedColor: =Self.Fill
            PressedFill: =Self.Color
            Text: ="Ok"
            Visible: =LoginInvalido
            Width: =157
            X: =242
            Y: =541
